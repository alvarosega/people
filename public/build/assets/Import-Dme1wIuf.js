import{r as l,j as a,a as v}from"./app-948RLx-n.js";import{A as E}from"./AuthenticatedLayout-Dd1w4HMp.js";import"./transition-B8yT2NZC.js";import"./ThemeToggle-BoAj17fM.js";function P({auth:j}){const[t,c]=l.useState([]),[o,n]=l.useState(!1),[m,p]=l.useState(null),[h,u]=l.useState({}),[x,g]=l.useState(""),y=r=>{p(r.target.files[0]),c([]),u({}),g("")},N=async()=>{if(!m)return;const r=new FormData;r.append("file",m),n(!0);try{const{data:s}=await v.post("/admin/base-llegada/import/preview",r,{headers:{"Content-Type":"multipart/form-data"}});c(s.rows||[])}catch(s){console.error(s),u({general:"Error al previsualizar el archivo."})}finally{n(!1)}},_=async()=>{var s,d,i,b,f;const r=t.filter(e=>!e.errors||e.errors.length===0).map(e=>({fecha:e.data.fecha,legajo:e.data.legajo,fecha_pago:e.data.fecha_pago??null,variable_100:e.data.variable_100??null,pago_porcentaje:e.data.pago_porcentaje??null,devol_alimen:e.data.devol_alimen??null,dias_alim:e.data.dias_alim??null,dev_territorio:e.data.dev_territorio??null,dias_terr:e.data.dias_terr??null,dev_casa:e.data.dev_casa??null,dias_casa:e.data.dias_casa??null,anillo:e.data.anillo??null,comentario:e.data.comentario??null}));if(r.length===0){alert("No hay filas válidas para importar ❌");return}console.log("Enviando datos:",r),n(!0);try{const e=await v.post("/admin/base-llegada/import/store",{rows:r});g(e.data.message||"Importación completada 🚀"),c([]),p(null),e.data.errors&&e.data.errors.length>0&&console.warn("Errores durante la importación:",e.data.errors)}catch(e){console.error("Error completo:",((s=e.response)==null?void 0:s.data)||e);const w=((i=(d=e.response)==null?void 0:d.data)==null?void 0:i.message)||"Error al confirmar importación";alert(`Error: ${w}`),(f=(b=e.response)==null?void 0:b.data)!=null&&f.errors&&console.error("Errores de validación:",e.response.data.errors)}finally{n(!1)}};return a.jsx(E,{user:j.user,header:a.jsx("h2",{className:"font-semibold text-xl text-gray-800",children:"Importar Base de Llegada"}),children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seleccionar archivo CSV o Excel"}),a.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:y,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),a.jsxs("div",{className:"flex gap-2 mb-4",children:[a.jsx("button",{onClick:N,disabled:!m||o,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Procesando...":"Previsualizar"}),t.length>0&&a.jsx("button",{onClick:_,disabled:o,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Importando...":"Confirmar Importación"})]}),h.general&&a.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded",children:h.general}),x&&a.jsx("div",{className:"mb-4 p-3 bg-green-100 border border-green-300 text-green-700 rounded",children:x}),t.length>0&&a.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Resumen:"})," ",t.length," filas encontradas, "," ",t.filter(r=>!r.errors||r.errors.length===0).length," válidas, "," ",t.filter(r=>r.errors&&r.errors.length>0).length," con errores"]})}),t.length>0&&a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"table-auto border-collapse border border-gray-300 w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[Object.keys(t[0].data).map((r,s)=>a.jsx("th",{className:"border px-2 py-1 bg-gray-100 text-left font-medium",children:r},s)),a.jsx("th",{className:"border px-2 py-1 bg-gray-100 font-medium",children:"Estado"})]})}),a.jsx("tbody",{children:t.map((r,s)=>a.jsxs("tr",{className:r.errors&&r.errors.length>0?"bg-red-50":"bg-white",children:[Object.values(r.data).map((d,i)=>a.jsx("td",{className:"border px-2 py-1",children:d??""},i)),a.jsx("td",{className:"border px-2 py-1",children:r.errors&&r.errors.length>0?a.jsxs("span",{className:"text-red-600 text-xs",children:["❌ ",r.errors.join(", ")]}):a.jsx("span",{className:"text-green-600",children:"✅ Válida"})})]},s))})]})})]})})}export{P as default};
