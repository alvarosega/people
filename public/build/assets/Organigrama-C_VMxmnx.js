import{r as l,a as x,j as e,H as b}from"./app-wHq-iQ3F.js";import{T as N}from"./index-CHNFZkjm.js";import{A as f}from"./AuthenticatedLayout-BTCMKkSr.js";import"./transition-DmDNRT49.js";import"./ThemeToggle-CmOVN8g3.js";const S=()=>{const n=l.useRef(null),[c,h]=l.useState([]),[j,u]=l.useState(!0),[d,p]=l.useState({width:0,height:0});l.useEffect(()=>{const t=()=>{n.current&&p({width:n.current.clientWidth,height:n.current.clientHeight})};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const g=t=>{var r,s,m;const i=t.name??((r=t.user)==null?void 0:r.nombre)??(t.legajo?`(${t.legajo})`:"Vacante"),a=(((s=t.attributes)==null?void 0:s.puesto)??((m=t.user)==null?void 0:m.puesto))||(t.banda?`Banda ${t.banda}`:"");return{name:i,title:a,id:t.id,legajo:t.legajo??null,banda:t.banda??null,nivel_jerarquico:t.nivel_jerarquico??0,orden:t.orden??0,vacante:!!t.vacante,user:t.user??null,attributes:t.attributes??{},children:(t.children||[]).map(g),__raw:t}},o=l.useCallback(async()=>{var t,i;u(!0);try{const a=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content");a&&(x.defaults.headers.common["X-CSRF-TOKEN"]=a),x.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const r=await x.get("/user/organigrama/data"),s=((i=r==null?void 0:r.data)==null?void 0:i.data)??null;h(s?[g(s)]:[])}catch(a){console.error("Error cargando organigrama:",a),alert("No se pudo cargar el organigrama.")}finally{u(!1)}},[]);l.useEffect(()=>{o()},[o]);const y=()=>({x:(d.width>0?d.width:800)/2,y:100}),v=({nodeDatum:t,toggleNode:i})=>{var s;const a=t.vacante?"#ff6b6b":"#2b6cb0",r=t.children&&t.children.length>0;return e.jsxs("g",{style:{cursor:"default"},children:[e.jsx("circle",{r:10,cx:-120,cy:-15,fill:a,stroke:"#fff",strokeWidth:2,className:"transition-all duration-200 hover:r-12"}),e.jsx("foreignObject",{x:-105,y:-40,width:230,height:80,children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm border border-gray-200 rounded-2xl p-4 shadow-lg transition-all duration-200 hover:shadow-xl hover:scale-105",style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"16px",padding:"12px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1)"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-gray-900 text-sm truncate",style:{fontSize:"14px",fontWeight:"700"},children:t.name||"Vacante"}),e.jsx("div",{className:"text-gray-600 text-xs truncate mt-1",style:{fontSize:"12px"},children:t.title||((s=t.attributes)==null?void 0:s.puesto)||""})]}),e.jsxs("div",{className:"flex-shrink-0 bg-gradient-to-r from-yellow-400 to-yellow-500 text-black px-2 py-1 rounded-full text-xs font-bold ml-2",style:{background:"linear-gradient(135deg, #f5e003, #e5b611)",color:"#000",padding:"4px 8px",borderRadius:"12px",fontSize:"10px",fontWeight:"700"},children:["N",t.nivel_jerarquico??"-"]})]}),e.jsxs("div",{className:"text-gray-500 text-xs flex items-center justify-between",style:{fontSize:"10px"},children:[e.jsx("span",{children:t.vacante?"VACANTE":t.legajo?`Legajo: ${t.legajo}`:"-"}),r&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:[t.children.length," subordinado",t.children.length!==1?"s":""]})]})]})}),r&&e.jsx("circle",{r:6,cx:130,cy:0,fill:"#e2e8f0",stroke:"#cbd5e1",strokeWidth:1,onClick:i,style:{cursor:"pointer"},className:"hover:fill-#cbd5e0"})]})};return j?e.jsxs(f,{header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Mi Organigrama"}),children:[e.jsx(b,{title:"Organigrama"}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando organigrama..."})]})})]}):e.jsxs(f,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Mi Organigrama"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Estructura organizacional de tu posición"})]}),e.jsx("button",{onClick:o,className:"bg-gradient-to-r from-yellow-400 to-yellow-500 text-black px-4 py-2 rounded-lg font-semibold hover:from-yellow-500 hover:to-yellow-600 transition-all duration-200",children:"Actualizar Vista"})]}),children:[e.jsx(b,{title:"Mi Organigrama"}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl border border-gray-200 overflow-hidden",style:{height:"calc(100vh - 200px)"},children:[e.jsx("div",{ref:n,className:"w-full h-full relative",children:!c||c.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl",children:"🏢"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Organigrama vacío"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No se encontró información en tu organigrama."}),e.jsx("button",{onClick:o,className:"bg-gradient-to-r from-yellow-400 to-yellow-500 text-black px-6 py-2 rounded-lg font-semibold hover:from-yellow-500 hover:to-yellow-600 transition-all duration-200",children:"Reintentar"})]})}):e.jsx(N,{data:c,translate:y(),orientation:"vertical",pathFunc:"elbow",zoomable:!0,collapsible:!0,renderCustomNodeElement:t=>v(t),allowForeignObjects:!0,pathClassFunc:()=>"stroke-gray-300 stroke-2",transitionDuration:300,dimensions:d})}),e.jsx("div",{className:"absolute bottom-4 left-4 bg-white/90 backdrop-blur-sm rounded-2xl p-3 shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-#2b6cb0 rounded-full"}),e.jsx("span",{className:"text-gray-600",children:"Posición ocupada"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-#ff6b6b rounded-full"}),e.jsx("span",{className:"text-gray-600",children:"Posición vacante"})]})]})})]})]})};export{S as default};
